## 数据类型之浮点型

光有整数是不够的，数学当中很多有趣的数字都是小数，甚至是无理数，这些要在计算机当中表示怎么办呢？显然，想要表示无限位的小数在计算机当中是不现实的，因此我们在接到表示小数的需求是总是会问对方你要的精度是多少。

举个简单的例子，GPS 大家都会用，GPS 定位返回的经纬度的精确度在几米到几十米的范围，使用经纬度的表示大概在小数点后5位的样子，因此只要我们的程序使用一个支持小数点后5位精度的类型来表示就够了，再多也是浪费。

那么我们会用什么类型来表示经纬度呢？使用 float 类型，也就是单精度浮点型。

C 语言标准规定 float 至少能表示 6 位有效数字，表示的数值范围至少在 10−3710−37 ~ 10371037 之间，例如：

![](https://kotlinblog-1251218094.costj.myqcloud.com/08ee47c0-6860-4060-97fb-266424b744c0/media/2020-07-02-21-58-01.png)

请大家注意，12345678912345678.9 与 12345600000000000.0 由于上 6 个有效位的数字是相同的，因此在只能表示 6 位有效数字的 float 类型上二者几乎值是相同的。

这所谓的浮点数的“浮”字，是非常有意思的，由于有效数字的位数是确定的，因此我们始终可以把一个数用科学计数法来表示，那么前面的两个数不管后面的数字是什么，表示出来都是 1.23456×10111.23456×1011，即无论数量级如何浮动，能表示的有效数字不变。

通常情况下，C 语言的实现中 float 占 32 位空间，其中 8 位用于表示指数及其符号，剩下的 24 位用于表示非指数部分及其符号。

符号

尾数

指数

1

23

8

±

小数部分，决定精度

-127~128 决定范围

对于指数的二进制位不全为 0 也不全为 1 时，即此时数值有指数位，通常表示的数值不是特别小的情况，有效数字部分会用隐含位 1 加上尾数部分来表示，将有效数字部分调整到 1~2 的范围内以此来扩大表示范围，因此可以认为是用 24 位来表示有效数字，那么实际上就是 224224，即 16777216，有 8 位有效数字，可以保证 7 位精度，以及对于 8 位精度的较小的数字的精度。

所以我们前面提到的 GPS 定位的例子，天安门的位置大概在 39.908156,116.398087，我们用 float 类型来存储，按照 C 语言标准的要求可以至少确保到以下精度：39.9081, 116.398，考虑到隐含位，实际上精度可以提升到 39.90815，116.39808，这个精度已经是米级别了。我们不妨做个小实验：

```c
#include <stdio.h>

int main(int argc, char ** argv) {
    printf("%f\n", 116.398087f - 116.3980f);
    printf("%f\n", 39.908156f - 39.9081f);
    return 0;
}
```

float 类型的格式化符是 `%f`，在数值后面加一个 `f` 就表示这个数是 float 类型。程序输出如下：

```
0.000084
0.000057
```

`116.398087f - 116.3980f` 明明应该是 `0.000087`，怎么成了 `0.000084` 了呢？因为精度丢失。同理，`39.908156f - 39.9081f` 应该是 `0.000056`，却成了 `0.000057`，不过我们可以看到前者的差值更大，因为显然 116.398087 的第六个小数位是从高位数的第九个有效数字位，而 39.908156 的第六个小数位是第八个有效数字位。

当然，前面我们只是通过一个实际应用的例子来告诉大家 float 的数值范围以及其精度的限制，使用时一定要评估好你的精度需要，免得因为精度丢失造成损失。

如果需要更大的精度，可以使用双精度浮点型，即 double 类型，还有 long double 类型，标准规定 long double 的表示范围不能小于 double，double 也不能小于 float。double 类型通常占用 64 位，表示的数据范围自然也更大，有效数字位数可以达到 15 ~ 16 位。

在 C 语言当中，浮点数还支持科学计算法的形式，例如：

```c
3E10
2.1123e-12
```

都是合法的 double 类型，如果在数字的后面加字符 `f` 或者 `F` 则表示 float 类型：

```c
3E10F
2.1123e-12f
```

通常我们习惯上使用 `f`。

请始终记住一点，不管是什么分数、小数，本质上在计算机内存当中存储的都是二进制的 0、1，关键是每一位的二进制如何对应浮点数当中的组成部分。只要是浮点数就一定要精度问题，使用时一定评估精度的需求。

特别需要注意的是，涉及钱相关的应用场景，请使用长整型等不存在精度问题的整数类型来表示，例如用 1 表示 0.00001 元等等，具体单位却决于业务的实际需要。